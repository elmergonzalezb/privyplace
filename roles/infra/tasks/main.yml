---
- include_tasks: ../k8s_common/namespace.yml
  vars:
    target_namespace: "{{ namespace }}"
  tags:
  - namespace

- name: ansible-executor
  block:
  - include_tasks: ../k8s_common/configmap.yml
    tags:
    - configmap
  - include_tasks: ../k8s_common/service.yml
    tags:
    - service
  - include_tasks: ../k8s_common/deployment.yml
    tags:
    - deployment
  - name: Wait for port {{ sshd_nodeport }} to become open on the host
    wait_for:
      port: "{{ sshd_nodeport }}"
      timeout: 60
  vars:
    app: ansible-executor
    target_namespace: "{{ namespace }}"
    configmap_name: sshd-authorized-keys
    configmap_filename: authorized_keys
    configmap_content: "{{ authorized_keys }}"
    serviceport: 22
    targetport: 22
    nodeport: "{{ sshd_nodeport }}"